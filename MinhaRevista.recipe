from calibre.web.feeds.news import BasicNewsRecipe

class MinhaRevista(BasicNewsRecipe):
    title = 'Minha Revista Diaria'
    description = 'Revista de Noticias e Novidades.'
    language = 'pt-BR'
    encoding = 'utf-8'

    # --- DIRETRIZ 1: Ignorar data ---
    # Pega artigos independente da data de publicacao.
    # O padrao e 7 dias.
    oldest_article = 9999

    # --- DIRETRIZ 2: 5 Artigos ---
    # Pega no maximo 5 artigos por feed.
    # O padrao e 100.
    max_articles_per_feed = 5

    # --- REFINAMENTO (Documentacao) ---
    
    # Habilita o algoritmo automatico de extracao de conteudo (Readability).
    # Isso ira "limpar" as paginas baixadas (JW.org) automaticamente.
    # O padrao e False.
    auto_cleanup = True

    # Desabilita o download de folhas de estilo (CSS).
    # O padrao e False.
    no_stylesheets = True

    # Nao precisamos mais de 'remove_tags' ou 'postprocess_html',
    # pois 'auto_cleanup = True' cuida da limpeza.

    # Lista de feeds
    feeds = [
        ('JW - Novidades PT', 'https://www.jw.org/pt/Novidades/rss/WhatsNewWebArticles/feed.xml'),
        ('JW - Whats New EN', 'https://www.jw.org/en/whats-new/rss/WhatsNewWebArticles/feed.xml'),
        ('THE NEWS (Beehiiv)', 'https://rss.beehiiv.com/feeds/j9teVW9Qmi.xml'),
    ]

    # --- Logica Hibrida ---
    # Este metodo decide QUAIS artigos devem passar pelo 'auto_cleanup'
    def print_version(self, url):
        #
        if "beehiiv.com" in url:
            # Retornar None FORCA o Calibre a usar o
            # conteudo do RSS (que ja e completo) e PULA o auto_cleanup.
            return None
        else:
            # Retornar a URL (para JW.org)
            # manda o Calibre baixar a pagina e,
            # como 'auto_cleanup=True', ele vai limpar a pagina.
            return url
