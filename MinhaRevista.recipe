from calibre.web.feeds.news import BasicNewsRecipe

class MinhaRevista(BasicNewsRecipe):
    title = 'Minha Revista Diaria'
    description = 'Revista de Noticias e Novidades.'
    language = 'pt-BR'
    encoding = 'utf-8'

    # --- DIRETRIZES (Estao funcionando) ---
    oldest_article = 9999
    max_articles_per_feed = 5
    no_stylesheets = True

    # --- DIRETRIZ DE CONFIANCA (Nova) ---
    # Forca o Calibre a usar o conteudo do feed quando
    # o download da pagina e pulado (via print_version).
    #
    use_embedded_content = True
    
    # --- DIRETRIZ DE SCRAPING (Apenas para JW.org) ---
    # Esta regra so sera aplicada as paginas baixadas (JW.org).
    # Ela sera ignorada para o "THE NEWS" (Beehiiv).
    keep_only_tags = [
        dict(name='article')
    ]

    # Lista de feeds
    feeds = [
        ('JW - Novidades PT', 'https://www.jw.org/pt/Novidades/rss/WhatsNewWebArticles/feed.xml'),
        ('JW - Whats New EN', 'https://www.jw.org/en/whats-new/rss/WhatsNewWebArticles/feed.xml'),
        ('THE NEWS (Beehiiv)', 'https://rss.beehiiv.com/feeds/j9teVW9Qmi.xml'),
    ]

    # --- O "INTERRUPTOR" HIBRIDO ---
    # Decide o que fazer para cada artigo
    def print_version(self, url):
        #
        if "beehiiv.com" in url:
            # Para o "THE NEWS": Nao baixe a pagina,
            # use o conteudo do RSS (que use_embedded_content=True manda usar).
            return None
        else:
            # Para o "JW.org": Baixe a pagina
            # e aplique a regra 'keep_only_tags' nela.
            return url
